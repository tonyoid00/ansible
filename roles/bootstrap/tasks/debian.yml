---

- name: APT update
  apt: update_cache=yes cache_valid_time=3600

- name: APT upgrade
  apt: upgrade=dist state=latest

- name: Installing packages
  apt: name='aptitude,fail2ban,mc,ntp,git,etckeeper,screen,vim,bash-completion,open-vm-tools' state=latest

- name: Remove LXC and related packages
  apt: name='liblxc1,lxc,dnsmasq,lxcfs,lxc-templates' state=absent purge=yes

- name: Replace /etc/hostname file
  replace: path=/etc/hostname regexp='^(.+)$' replace="{{ internal_hostname }}.{{ domain }}"

- name: Set hostname
  hostname: name="{{ internal_hostname }}.{{ domain }}"

- name: check current timezone
  shell: cat /etc/timezone
  register: current_zone
  changed_when: false

- name: Set timezone to "{{ timezone }}"
  command: timedatectl set-timezone "{{ timezone }}"
  when: current_zone.stdout != timezone

- name: Stop and disable multipathd services
  service: name={{ item }} state=stopped enabled=no
  with_items:
    - multipathd.socket
    - multipathd.service
  when: ansible_distribution_major_version == '20'
